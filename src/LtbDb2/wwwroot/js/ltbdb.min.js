function split(e){return e.split(/;\s*/)}function extractLast(e){return split(e).pop()}String.prototype.format=function(){for(var e=this,t=arguments.length;t--;)e=e.replace(new RegExp("\\{"+t+"\\}","gm"),arguments[t]);return e},String.prototype.formatEx=function(e){var t,i=this;for(t in e)i=i.replace(new RegExp("\\{"+t+"\\}","gm"),e[t]);return i},$(function(){$("#tags").autocomplete({source:function(e,t){$.getJSON("/search/tag",{term:extractLast(e.term)},t)},search:function(){if(extractLast(this.value).length<3)return!1},focus:function(){return!1},select:function(e,t){var i=split(this.value);return i.pop(),i.push(t.item.value),i.push(""),this.value=i.join("; "),!1}}),$(".ac-category").autocomplete({source:"/search/category",minLength:0,select:function(e,t){t.item&&$(e.target).val(t.item.value)}}).focus(function(){$(this).autocomplete("search",$(this).val())}),$(".ac-tag").autocomplete({source:"/search/tag",minLength:0,select:function(e,t){t.item&&$(e.target).val(t.item.value)}}).focus(function(){$(this).autocomplete("search",$(this).val())}),jbox_image=new jBox("Image",{});var t=$("#story-container"),i='<div class="input-group mb-3" >\t\t\t<input class="form-control" type="text" name="stories" placeholder="Inhalt" />\t\t\t<button class="btn btn-outline-secondary story-ins" type="button"><i class="fa-solid fa-plus"></i></button>\t\t\t<button class="btn btn-outline-secondary story-rem" type="button"><i class="fa-solid fa-minus"></i></button>\t\t</div>';function n(e){e.replaceWith(e.clone(!0))}$(document).on("click","#story-add",function(e){$(i).appendTo(t)}),$(document).on("click",".story-ins",function(e){var t=$(this).parent();$(i).insertBefore(t)}),$(document).on("click",".story-rem",function(e){$(this).parent().remove()}),$("#deleteSubmit").click(function(){var e=$("#delete").data("method"),t=$("#delete").data("url");$.ajax({type:e,url:t}).done(function(){location.href="/"}).fail(function(){$("#error").html('<div class="alert alert-danger">Löschen des Buches fehlgeschlagen.</div>')})}),$("#image").on("click",function(){$("#image-upload").click()}),$("#image-upload").change(function(){if(void 0!==window.FileReader){var e=$("#image-upload").get(0).files,t=new FileReader;if(!e[0].type.match("image"))return n($("#image-upload")),void alert("Dateityp nicht unterstützt.");t.onload=function(e){$("#image").attr("src",e.target.result)},t.readAsDataURL(e[0]),$("#remove").val(!1),$("#image-reset").show()}else alert("Dein Browser unterstützt diese Funktion nicht. Die Vorschau ist nicht verfügbar.")}),$("#image-delete").click(function(e){e.preventDefault(),n($("#image-upload")),$("#image").attr("src",$(this).data("src")),$("#remove").val(!0),$("#image-reset").show()}),$("#image-reset").click(function(e){e.preventDefault(),n($("#image-upload")),$("#image").attr("src",$(this).data("src")),$("#remove").val(!1),$("#image-reset").hide()}),$.validator.setDefaults({highlight:function(e){$(e).addClass("is-invalid")},unhighlight:function(e){$(e).removeClass("is-invalid")}}),$.validator.addMethod("regex",function(e,t,i){i=new RegExp(i);return this.optional(t)||i.test(e)},"Please check your input."),$.validator.addMethod("nowhitespace",function(e,t){return this.optional(t)||""!=e.trim()},"No white space."),$.validator.addMethod("stringarrayitemmaxlength",function(e,t,i){for(var n=e.split(";"),a=0;a<n.length;a++)if(n[a].trim().length>i)return!1;return!0},"Length of word too long."),$("#book-form").validate({rules:{number:{required:!0,nowhitespace:!0,regex:"^[0-9]+$"},title:{required:!0,nowhitespace:!0,maxlength:200},category:{required:!0,nowhitespace:!0,maxlength:100},tags:{stringarrayitemmaxlength:50}},messages:{number:{required:"Bitte gib eine Nummer ein.",nowhitespace:"Bitte gib eine Nummer ein.",regex:"Bitte gib eine Nummer ein."},title:{required:"Bitte gib einen Titel ein.",nowhitespace:"Bitte gib einen Titel ein.",maxlength:"Der Titel darf max. 200 Zeichen lang sein."},category:{required:"Bitte gib eine Reihe ein.",nowhitespace:"Bitte gib eine Reihe ein.",maxlength:"Die Reihe darf max. 100 Zeichen lang sein."},tags:{stringarrayitemmaxlength:"Ein Tag darf max. 50 Zeichen lang sein."}}}),$("#login-form").validate({rules:{username:{required:!0,nowhitespace:!0},password:{required:!0,nowhitespace:!0}},messages:{username:{required:"Bitte gib einen Benutzernamen ein.",nowhitespace:"Bitte gib einen Benutzernamen ein."},password:{required:"Bitte gib ein Passwort ein.",nowhitespace:"Bitte gib ein Passwort ein."}}}),$("#category-move-form").validate({rules:{from:{required:!0,nowhitespace:!0,maxlength:100},to:{required:!0,nowhitespace:!0,maxlength:100}},messages:{from:{required:"Bitte gib eine Reihe ein.",nowhitespace:"Bitte gib eine Reihe ein.",maxlength:"Die Reihe darf max. 100 Zeichen lang sein."},to:{required:"Bitte gib eine Reihe ein.",nowhitespace:"Bitte gib eine Reihe ein.",maxlength:"Die Reihe darf max. 100 Zeichen lang sein."}}})});