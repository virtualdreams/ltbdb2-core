function split(e){return e.split(/;\s*/)}function extractLast(e){return split(e).pop()}$.widget("custom.catcomplete",$.ui.autocomplete,{_renderMenu:function(i,e){var a=this,n="";$.each(e,function(e,t){t.category!=n&&(i.append('<li class="ui-autocomplete-category">'+t.category+"</li>"),n=t.category),a._renderItemData(i,t)})}}),String.prototype.format=function(){for(var e=this,t=arguments.length;t--;)e=e.replace(new RegExp("\\{"+t+"\\}","gm"),arguments[t]);return e},String.prototype.formatEx=function(e){var t,i=this;for(t in e)i=i.replace(new RegExp("\\{"+t+"\\}","gm"),e[t]);return i},$(function(){$("[data-href]").click(function(){var e=$(this).data("href");location.href=e}),$("#q").autocomplete({source:"/search/title",minLength:3,select:function(e,t){t.item&&$(e.target).val(t.item.value),$(e.target.form).submit()}}),$(".t").autocomplete({source:function(e,t){$.getJSON("/search/tag",{term:extractLast(e.term)},t)},search:function(){if(extractLast(this.value).length<3)return!1},focus:function(){return!1},select:function(e,t){var i=split(this.value);return i.pop(),i.push(t.item.value),i.push(""),this.value=i.join("; "),!1}}),$(".c").autocomplete({source:"/search/category",minLength:0,select:function(e,t){t.item&&$(e.target).val(t.item.value)}}).focus(function(){$(this).autocomplete("search",$(this).val())}),jbox_image=new jBox("Image",{downloadButton:!0});var t=$("#story-container"),i='<div class="story">\t\t\t\t\t\t\t\t<input class="input" type="text" name="stories" value="" placeholder="Inhalt" /> <span class="button-green story-ins" title="Eintrag darüber einfügen."><i class="material-icons material-icons-small">add</i></span> <span class="button-red story-rem" title="Eintrag entfernen."><i class="material-icons material-icons-small">remove</i></span>\t\t\t\t\t\t\t</div>';$(document).on("click","#story-add",function(e){$(i).appendTo(t)}),$(document).on("click",".story-ins",function(e){var t=$(this).parent();$(i).insertBefore(t)}),$(document).on("click",".story-rem",function(e){$(this).parent().remove()});new jBox("Modal",{attach:$("#delete-book"),content:$("#delete-book-dialog"),overlay:!0,closeOnClick:"body",preventDefault:!0,closeButton:"title",getTitle:"data-title"});function a(e){e.replaceWith(e.clone(!0))}$("#delete-book-submit").click(function(){id=$("#delete-book").data("id"),$.ajax({type:"POST",url:"/book/delete/"+id,statusCode:{403:function(){location.href="/account/login?ReturnUrl="+encodeURIComponent(location.pathname)},404:function(){alert("Resource not found.")}},success:function(e){e.Success&&(location.href="/")}})}),$("#image").on("click",function(){$("#image-upload").click()}),$("#image-upload").change(function(){if(void 0!==window.FileReader){var e=$("#image-upload").get(0).files,t=new FileReader;if(!e[0].type.match("image"))return a($("#image-upload")),void alert("Dateityp nicht unterstützt.");t.onload=function(e){$("#image").attr("src",e.target.result)},t.readAsDataURL(e[0]),$("#remove").val(!1),$("#image-reset").show()}else alert("Dein Browser unterstützt diese Funktion nicht. Die Vorschau ist nicht verfügbar.")}),$("#image-delete").click(function(e){e.preventDefault(),a($("#image-upload")),$("#image").attr("src",$(this).data("src")),$("#remove").val(!0),$("#image-reset").show()}),$("#image-reset").click(function(e){e.preventDefault(),a($("#image-upload")),$("#image").attr("src",$(this).data("src")),$("#remove").val(!1),$("#image-reset").hide()}),$.validator.addMethod("regex",function(e,t,i){return this.optional(t)||e.match(i)},"Please check your input."),$.validator.addMethod("nowhitespace",function(e,t){return this.optional(t)||""!=e.trim()},"No white space."),$.validator.addMethod("stringarrayitemmaxlength",function(e,t,i){for(var a=e.split(";"),n=0;n<a.length;n++)if(a[n].trim().length>i)return!1;return!0},"Length of word too long."),$("#book-form").validate({errorClass:"field-validation-error",validClass:"field-validation-valid",errorElement:"span",rules:{number:{required:!0,nowhitespace:!0,regex:"[0-9]+"},title:{required:!0,nowhitespace:!0,maxlength:200},category:{required:!0,nowhitespace:!0,maxlength:100},tags:{stringarrayitemmaxlength:50}},messages:{number:{required:"Bitte gib eine Nummer ein.",nowhitespace:"Bitte gib eine Nummer ein.",regex:"Bitte gib eine Nummer ein."},title:{required:"Bitte gib einen Titel ein.",nowhitespace:"Bitte gib einen Titel ein.",maxlength:"Der Titel darf max. 200 Zeichen lang sein."},category:{required:"Bitte gib eine Kategorie ein.",nowhitespace:"Bitte gib eine Kategorie ein.",maxlength:"Die Kategorie darf max. 100 Zeichen lang sein."},tags:{stringarrayitemmaxlength:"Ein Tag darf max. 50 Zeichen lang sein."}}}),$("#login-form").validate({errorClass:"field-validation-error",validClass:"field-validation-valid",errorElement:"span",rules:{username:{required:!0,nowhitespace:!0},password:{required:!0,nowhitespace:!0}},messages:{username:{required:"Bitte gib einen Benutzernamen ein.",nowhitespace:"Bitte gib einen Benutzernamen ein."},password:{required:"Bitte gib ein Passwort ein.",nowhitespace:"Bitte gib ein Passwort ein."}}}),$("#category-move-form").validate({errorClass:"field-validation-error",validClass:"field-validation-valid",errorElement:"span",rules:{from:{required:!0,nowhitespace:!0,maxlength:100},to:{required:!0,nowhitespace:!0,maxlength:100}},messages:{from:{required:"Bitte gib eine Kategorie ein.",nowhitespace:"Bitte gib eine Kategorie ein.",maxlength:"Die Kategorie darf max. 100 Zeichen lang sein."},to:{required:"Bitte gib eine Kategorie ein.",nowhitespace:"Bitte gib eine Kategorie ein.",maxlength:"Die Kategorie darf max. 100 Zeichen lang sein."}}})});